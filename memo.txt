CrossTrans v1.9.7 - Project Structure
========================================

gemini_translator_v4/
├── main.py                  # Entry point
├── translator.py            # Backward compatible
├── config.py                # Configuration management
├── requirements.txt         # Dependencies
│
└── src/
    ├── constants.py         # VERSION, LANGUAGES, PROVIDERS_LIST, MODEL_PROVIDER_MAP
    ├── app.py               # TranslatorApp class (main application)
    │
    ├── core/
    │   ├── clipboard.py     # ClipboardManager
    │   ├── api_manager.py   # AIAPIManager (14 providers)
    │   ├── translation.py   # TranslationService, dictionary_lookup()
    │   ├── hotkey.py        # HotkeyManager (global hotkeys)
    │   ├── history.py       # Translation history (100 entries)
    │   ├── multimodal.py    # Vision processing (OCR)
    │   ├── file_processor.py # Document text extraction
    │   ├── pdf_ocr.py       # Scanned PDF OCR support
    │   ├── screenshot.py    # Screenshot capture for OCR
    │   ├── crypto.py        # Secure API key storage (DPAPI)
    │   ├── ssl_pinning.py   # SSL certificate pinning
    │   ├── auth.py          # Windows Hello authentication
    │   ├── provider_health.py # Smart provider fallback
    │   ├── drop_handler.py  # Drag-drop file handler
    │   ├── quota_manager.py # Trial mode quota tracking
    │   ├── trial_api.py     # Trial mode API handler
    │   └── runtime_utils.py # Runtime context for trial API security
    │
    ├── ui/
    │   ├── settings.py      # SettingsWindow (with Show All API Keys)
    │   ├── dialogs.py       # APIErrorDialog, TrialExhaustedDialog, TrialFeatureDialog
    │   ├── attachments.py   # File attachment widget (double-click preview)
    │   ├── dictionary_mode.py # Dictionary word selection UI
    │   ├── history_dialog.py # History viewer (with search)
    │   ├── progress_dialog.py # Progress indicator
    │   ├── toast.py         # Toast notifications
    │   ├── tray.py          # System tray manager
    │   └── tooltip.py       # Tooltip widget, Dictionary popup
    │
    └── utils/
        ├── logging_setup.py # setup_logging()
        ├── single_instance.py # is_already_running()
        └── updates.py       # check_for_updates(), download_and_install_update()

========================================
How to Use
========================================

Task                    Command/File
----                    ------------
Run app                 python main.py
Build exe               pyinstaller CrossTrans.spec
Run tests               pytest tests/ --cov=src

========================================
When Editing Code
========================================

Want to change...              Edit this file
-----------------              --------------
Constants (VERSION, LANGUAGES) src/constants.py
Clipboard logic                src/core/clipboard.py
API providers                  src/core/api_manager.py
Translation prompts            src/core/translation.py
Hotkey registration            src/core/hotkey.py
History management             src/core/history.py
Vision/OCR processing          src/core/multimodal.py
File text extraction           src/core/file_processor.py
Scanned PDF OCR                src/core/pdf_ocr.py
Screenshot capture             src/core/screenshot.py
API key encryption             src/core/crypto.py
SSL pinning                    src/core/ssl_pinning.py
Windows Hello auth             src/core/auth.py
Provider fallback logic        src/core/provider_health.py
Trial mode quota               src/core/quota_manager.py
Trial mode API                 src/core/trial_api.py
Runtime context (security)     src/core/runtime_utils.py
Settings UI                    src/ui/settings.py
Error dialogs                  src/ui/dialogs.py
File attachments widget        src/ui/attachments.py
Dictionary word selection      src/ui/dictionary_mode.py
History dialog (with search)   src/ui/history_dialog.py
Progress indicator             src/ui/progress_dialog.py
Toast notifications            src/ui/toast.py
System tray                    src/ui/tray.py
Tooltip widget                 src/ui/tooltip.py
Main app (tray, tooltip, popup) src/app.py
Update checker                 src/utils/updates.py

========================================
New Features in v1.9.7
========================================

1. Screenshot Translation (Win+Alt+S)
   - Capture any screen region for OCR translation
   - Multi-monitor support with virtual screen coordinates
   - Semi-transparent overlay with drag selection
   - Configurable target language in Settings > Hotkeys
   - "Open Translator" loads screenshot into Attachments
   - Vision capability check before capture

2. Double-click to Preview Attachments
   - Double-click any attachment to open with system default app
   - Tooltip shows "(Double-click to preview)" hint
   - Error handling for deleted files

3. Auto-check Updates on Startup
   - Non-intrusive toast notification
   - Background check after 3 seconds delay
   - Clickable link to download page

4. UI Improvements
   - Screenshot Translate section in Settings > Hotkeys tab
   - Target language dropdown for screenshot OCR
   - Vision status indicator in system tray menu

========================================
Previous Features (v1.9.6)
========================================

1. Critical Bug Fix
   - Fixed Dictionary Language Pack installation in EXE builds
   - Root cause: sys.executable pointed to EXE instead of Python interpreter
   - New: Auto-detects system Python when running from EXE
   - Searches PATH, Python Launcher (py), and common install locations

2. Technical Changes
   - Added get_python_executable() helper function in nlp_manager.py
   - Proper handling of frozen/PyInstaller environment detection
   - Graceful fallback when Python not found in PATH

========================================
Previous Features (v1.9.5)
========================================

1. Bug Fixes
   - Fixed API Key saving: Primary key no longer moves to Backup position
   - Fixed Dictionary Language Pack installation hanging issue
   - Replaced subprocess.run with subprocess.Popen for better control

2. UI Improvements
   - Animated "Installing..." text with moving dots and color cycling
   - Added Trial Mode warning in API Key tab
   - Google provider now uses REST API (SDK removed, EXE 30MB smaller)

3. Settings Tab
   - API Key row position preserved when testing/saving
   - Trial Mode warning: "No API keys = Trial Mode (limited quota)"

========================================
Previous Features (v1.9.4 and earlier)
========================================

1. HuggingFace Provider Added
   - New AI provider: HuggingFace Inference API
   - 14 AI providers now supported (was 13)
   - Models: Qwen2.5 series, Llama 3.x, Mistral, Phi, Gemma, DeepSeek
   - API endpoint: router.huggingface.co (new endpoint)

2. Trial Mode Enhancement
   - HuggingFace added to fallback chain
   - Fallback order: Cerebras → SambaNova → Groq → HuggingFace → Gemini
   - Default model: meta-llama/Llama-3.1-70B-Instruct

3. Settings Improvements
   - Test button now saves API key even on test failure
   - Previously only saved on successful test

4. Backend (Cloudflare Worker)
   - Added Supabase analytics logging
   - Track usage statistics per device
   - Monitor provider performance

========================================
Previous Features (v1.9.3)
========================================

1. Security Enhancement
   - App context validation for Trial mode proxy API
   - X-App-Context header with obfuscated token
   - Prevents unauthorized API abuse

2. Model Updates
   - Updated Google Gemini models (only active, free-tier)
   - Gemini 3.0 Flash, 2.5 series, 2.0 series

3. Bug Fixes
   - Fixed Dictionary button color (was blue due to ttkbootstrap autostyle)
   - Added autostyle=False to prevent theme override

========================================
Previous Features (v1.9.2)
========================================

1. Dictionary Mode
   - Interactive word selection (click, drag, shift+click)
   - Word-by-word lookup with definitions, pronunciation, examples
   - Words flow like paragraph with line wrapping
   - Expand button for larger view
   - Animation feedback while looking up
   - Separate result window (doesn't replace tooltip)

2. Model Updates
   - 180+ models from 13 providers
   - Latest: Gemini 2.5, GPT-4.1, o3, Claude 4.5, DeepSeek-R1, Grok 3

3. UI Improvements
   - Dictionary button in tooltip and main window
   - Dictionary Lookup button with loading animation

========================================
Previous Features
========================================

v1.9.0:
- Trial Mode (100 free translations/day)
- Rebranding from "AI Translator" to "CrossTrans"
- Trial mode indicator in tooltip

v1.8.0:
- Attachments UI improvements with smart button colors
- System tray menu reorganization
- Drag-drop visual feedback

v1.7.0:
- Windows Hello Authentication (PIN, Fingerprint, Face)
- Show All API Keys Button with authentication
- Smart Provider Fallback (auto-switch to backup)
- Toast Notifications
- Scanned PDF OCR
- Search History
